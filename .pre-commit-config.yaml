# Baseline pre-commit configuration for Red Hat AI-Ready repositories
#
# This config includes:
# 1. Red Hat security/compliance hooks (rh-pre-commit)
# 2. AI-readiness hooks from this repository
#
# To use this config:
#   1. Copy this file to your repo root as .pre-commit-config.yaml
#   2. Run: pre-commit install
#   3. Run: pre-commit install --hook-type pre-push  (for AGENTS.md validation and tests)
#   4. Run: pre-commit install --hook-type commit-msg  (for conventional commits)
#   5. Run: pre-commit run --all-files (to test)
#
# See: https://pre-commit.com/

repos:
  # Red Hat security and compliance hooks
  - repo: https://gitlab.cee.redhat.com/infosec-public/developer-workbench/tools
    rev: rh-pre-commit-2.3.2 # Use specific tag (https://gitlab.cee.redhat.com/infosec-public/developer-workbench/tools/-/tags)
    hooks:
      - id: rh-pre-commit

  # AI-readiness hooks
  - repo: https://github.com/openshift-hyperfleet/rh-hooks-ai
    rev: v1.0.3 # Updated automatically by release workflow
    hooks:
      - id: check-rh-precommit
      - id: validate-agents-md # Runs on git push, requires AGENTS.md - comment out if not using
      - id: ai-attribution-reminder
      # - id: check-version  # Optional: Checks for updates once per 24h (non-blocking)

  # Commit message validation
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v4.3.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]
        args: [--verbose]

  # Python code quality hooks
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.9
    hooks:
      # Run the linter with auto-fix
      - id: ruff
        args: [--fix]
      # Run the formatter
      - id: ruff-format

  # Type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.19.1
    hooks:
      - id: mypy
        args: [--config-file=src/api/pyproject.toml, --ignore-missing-imports]
        additional_dependencies:
          - "apache-age-python"
          - "fastapi[standard]"
          - "pydantic-settings"
          - "psycopg2"
          - "types-psycopg2"
          - "pytest"
          - "structlog"
        files: ^src/api/

  # Auto-export system properties on value object changes
  - repo: local
    hooks:
      - id: docs-export
        name: Export system properties documentation
        entry: bash -c 'make docs-export && git add website/src/data/system-properties.json'
        language: system
        pass_filenames: false
        files: ^(src/api/graph/domain/value_objects\.py|scripts/export-system-properties\.py)$
      - id: pytest
        name: pytest
        entry: bash -c 'cd src/api && uv run pytest tests/unit -v'
        language: system
        pass_filenames: false
        stages: [pre-push]
